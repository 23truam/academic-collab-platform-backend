spring:
  datasource:
    url: jdbc:mysql://localhost:3306/academic_collab?allowPublicKeyRetrieval=true&useSSL=false&serverTimezone=UTC&characterEncoding=utf8&createDatabaseIfNotExist=true
    username: root
    password: zxh68080656
    driver-class-name: com.mysql.cj.jdbc.Driver
    type: org.springframework.jdbc.datasource.DriverManagerDataSource
  sql:
    init:
      mode: always
      schema-locations: classpath:sql/init.sql,classpath:sql/chat_tables.sql
      # 关闭数据脚本初始化（不加载任何数据）
      # data-locations: classpath:sql/init_chat_data.sql
      continue-on-error: false
  jpa:
    hibernate:
      ddl-auto: none
  redis:
    # Redis服务器地址
    host: localhost
    # Redis服务器端口
    port: 6379
    # Redis数据库索引（0-15）
    database: 1
    # Redis密码（如果没有设置密码，可以注释掉）
    password: zxh68080656
    # 连接超时时间（毫秒）
    timeout: 5000ms
    # 连接池配置
    lettuce:
      pool:
        # 最大连接数
        max-active: 8
        # 最大空闲连接数
        max-idle: 8
        # 最小空闲连接数
        min-idle: 0
        # 获取连接最大等待时间（毫秒）
        max-wait: -1ms
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
    virtual-host: /
    # 生产端可靠性
    publisher-confirm-type: correlated
    publisher-returns: true
    template:
      mandatory: true
    listener:
      simple:
        acknowledge-mode: manual
        prefetch: 20
        concurrency: 2
        max-concurrency: 8

mybatis:
  #mapper配置文件
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.example.academic_collab_platform_backend.model
  configuration:
    #开启驼峰命名
    map-underscore-to-camel-case: true
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

# JWT配置
jwt:
  secret: academic-collab-platform-secret-key-2024
  expiration: 86400000  # 24小时

server:
  port: 8081
  jackson:
    serialization:
      write-dates-as-timestamps: false

chat:
  messaging:
    mode: rabbit # rabbit | direct（开关，便于灰度/回退）
    # 🆕 推拉模式配置（第二阶段+第三阶段）
    push-pull:
      enabled: true # 启用推拉混合模式
      phase: 3 # 🆕 升级到第三阶段：完整优化（1=在线检查，2=离线处理，3=性能优化）
      enhanced-mode: true # 🆕 启用增强版简化方案
      
      # 🆕 第二阶段：离线消息配置
      offline-message-limit: 100 # 离线消息查询限制
      max-offline-days: 7 # 最多查询7天内的离线消息
      pull-timeout-hours: 1 # 离线消息拉取请求幂等性超时（小时）
      
      # 🆕 第三阶段：性能优化配置
      batch-size: 50 # 批量处理大小
      max-batch-size: 500 # 最大批量限制
      processing-timeout-ms: 30000 # 处理超时时间（毫秒）
      stats-expire-hours: 24 # 统计信息过期时间（小时）
      
      # 🆕 监控配置
      monitoring:
        enabled: true # 启用监控
        log-slow-queries: true # 记录慢查询
        slow-query-threshold-ms: 1000 # 慢查询阈值（毫秒）